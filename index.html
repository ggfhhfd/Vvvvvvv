<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClashData - Ø¥Ø¯Ø§Ø±Ø© ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; }
        .upload-container { background: #1e1e1e; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 100%; max-width: 450px; text-align: center; margin-bottom: 20px; }
        h2, h3 { color: #ff4757; margin-bottom: 15px; }
        input[type="file"] { background: #2d2d2d; border: 1px dashed #555; padding: 15px; border-radius: 10px; width: 100%; box-sizing: border-box; cursor: pointer; color: #ccc; margin-bottom: 15px; }
        button#uploadBtn { background: linear-gradient(45deg, #ff4757, #ff6b81); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .progress-area { margin: 15px 0; display: none; }
        .bar { background: #333; height: 10px; border-radius: 5px; overflow: hidden; }
        .fill { background: #2ed573; width: 0%; height: 100%; transition: 0.2s; }
        #status { font-size: 14px; margin-top: 10px; color: #eccc68; }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª */
        .video-item { background: #262626; padding: 15px; border-radius: 15px; margin-bottom: 20px; width: 100%; max-width: 450px; border: 1px solid #333; position: relative; }
        video { width: 100%; border-radius: 10px; margin-top: 10px; background: #000; }
        
        .actions { display: flex; justify-content: space-between; align-items: center; margin-top: 5px; }
        .delete-btn { background: none; color: #ff4757; border: 1px solid #ff4757; padding: 4px 8px; border-radius: 5px; cursor: pointer; font-size: 11px; transition: 0.3s; }
        .delete-btn:hover { background: #ff4757; color: white; }
        
        .download-link { background: #2ed573; color: white; text-decoration: none; padding: 4px 10px; border-radius: 5px; font-size: 11px; font-weight: bold; display: inline-flex; align-items: center; transition: 0.3s; }
        .download-link:hover { background: #26af5c; transform: translateY(-1px); }
        .video-title { font-size: 14px; color: #eee; font-weight: bold; text-align: right; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; max-width: 200px; }
    </style>
</head>
<body>

    <div class="upload-container">
        <h2>ğŸš€ ClashData</h2>
        <input type="file" id="videoFile" accept="video/*">
        
        <div class="progress-area" id="progressArea">
            <div class="bar"><div class="fill" id="progressFill"></div></div>
            <p id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹...</p>
        </div>

        <button id="uploadBtn" onclick="startUploadProcess()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†</button>
    </div>

    <h3 style="margin-top: 20px;">ğŸ“º Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©</h3>
    <div id="videoList" style="width: 100%; display: flex; flex-direction: column; align-items: center;">
        <p style="color:#666;">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©...</p>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Ø¨ÙŠØ§Ù†Ø§ØªÙƒ (Ø«Ø§Ø¨ØªØ© ÙˆÙ…Ø¬Ø±Ø¨Ø©)
    const firebaseConfig = {
        apiKey: "AIzaSyAm1OfTW_qS4lhSGlqgDd6fiLDj3u93wqI",
        authDomain: "clashdata-8424c.firebaseapp.com",
        databaseURL: "https://clashdata-8424c-default-rtdb.firebaseio.com",
        projectId: "clashdata-8424c",
        storageBucket: "clashdata-8424c.firebasestorage.app",
        appId: "1:1063000922754:web:87087f81c28c2659cb329b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const CLOUD_NAME = "dkpddgzqj";
    const UPLOAD_PRESET = "b2aumssr";

    window.startUploadProcess = async function() {
        const fileInput = document.getElementById('videoFile');
        const file = fileInput.files[0];
        const btn = document.getElementById('uploadBtn');
        const status = document.getElementById('status');
        const progressArea = document.getElementById('progressArea');
        const progressFill = document.getElementById('progressFill');

        if (!file) return alert("Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ!");

        btn.disabled = true;
        progressArea.style.display = 'block';

        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', UPLOAD_PRESET);

        const xhr = new XMLHttpRequest();
        xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, true);

        xhr.upload.onprogress = (e) => {
            const percent = (e.loaded / e.total) * 100;
            progressFill.style.width = percent + '%';
            status.innerText = `ØªÙ… Ø±ÙØ¹: ${Math.round(percent)}%`;
        };

        xhr.onload = function() {
            const data = JSON.parse(xhr.responseText);
            if (data.secure_url) {
                const videoRef = ref(db, 'my_videos');
                push(videoRef, {
                    name: file.name,
                    url: data.secure_url,
                    date: new Date().toISOString()
                }).then(() => {
                    status.innerText = "ØªÙ… Ø¨Ù†Ø¬Ø§Ø­! âœ…";
                    btn.disabled = false;
                    fileInput.value = "";
                    setTimeout(() => { progressArea.style.display = 'none'; }, 2000);
                });
            }
        };
        xhr.send(formData);
    };

    const videoListDiv = document.getElementById('videoList');
    onValue(ref(db, 'my_videos'), (snapshot) => {
        videoListDiv.innerHTML = "";
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(key => {
                const video = data[key];
                
                // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„ÙŠØµØ¨Ø­ Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± (Ø¥Ø¶Ø§ÙØ© fl_attachment)
                const downloadUrl = video.url.replace('/upload/', '/upload/fl_attachment/');

                const item = document.createElement('div');
                item.className = 'video-item';
                item.innerHTML = `
                    <div class="actions">
                        <span class="video-title" title="${video.name}">${video.name}</span>
                        <div>
                            <a href="${downloadUrl}" class="download-link" title="ØªØ­Ù…ÙŠÙ„ Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ù†Øª">ØªØ­Ù…ÙŠÙ„ ğŸ“¥</a>
                            <button class="delete-btn" onclick="deleteVideo('${key}')">Ø­Ø°Ù ğŸ—‘ï¸</button>
                        </div>
                    </div>
                    <video controls src="${video.url}" preload="metadata"></video>
                `;
                videoListDiv.appendChild(item);
            });
        } else {
            videoListDiv.innerHTML = "<p style='color:#666;'>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹.</p>";
        }
    });

    window.deleteVideo = function(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆØŸ")) {
            remove(ref(db, `my_videos/${id}`));
        }
    };
</script>

</body>
</html>
