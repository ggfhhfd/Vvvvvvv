<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClashData - Ø±ÙØ¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .upload-container { background: #1e1e1e; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 90%; max-width: 400px; text-align: center; }
        h2 { color: #ff4757; margin-bottom: 20px; }
        input[type="file"] { background: #2d2d2d; border: 1px dashed #555; padding: 15px; border-radius: 10px; width: 100%; box-sizing: border-box; cursor: pointer; color: #ccc; margin-bottom: 20px; }
        button { background: linear-gradient(45deg, #ff4757, #ff6b81); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .progress-area { margin: 20px 0; display: none; }
        .bar { background: #333; height: 10px; border-radius: 5px; overflow: hidden; }
        .fill { background: #2ed573; width: 0%; height: 100%; transition: 0.2s; }
        #status { font-size: 14px; margin-top: 10px; color: #eccc68; }
    </style>
</head>
<body>

<div class="upload-container">
    <h2>ğŸš€ ClashData</h2>
    <input type="file" id="videoFile" accept="video/*">
    
    <div class="progress-area" id="progressArea">
        <div class="bar"><div class="fill" id="progressFill"></div></div>
        <p id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø±ÙØ¹...</p>
    </div>

    <button id="uploadBtn" onclick="startUploadProcess()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Ø¨ÙŠØ§Ù†Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ
    const firebaseConfig = {
        apiKey: "AIzaSyAm1OfTW_qS4lhSGlqgDd6fiLDj3u93wqI",
        authDomain: "clashdata-8424c.firebaseapp.com",
        databaseURL: "https://clashdata-8424c-default-rtdb.firebaseio.com",
        projectId: "clashdata-8424c",
        storageBucket: "clashdata-8424c.firebasestorage.app",
        appId: "1:1063000922754:web:87087f81c28c2659cb329b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Ø¨ÙŠØ§Ù†Ø§Øª Cloudinary Ù…Ù† ØµÙˆØ±Ùƒ
    const CLOUD_NAME = "dkpddgzqj";
    const UPLOAD_PRESET = "b2aumssr"; 

    window.startUploadProcess = async function() {
        const fileInput = document.getElementById('videoFile');
        const file = fileInput.files[0];
        const btn = document.getElementById('uploadBtn');
        const status = document.getElementById('status');
        const progressArea = document.getElementById('progressArea');
        const progressFill = document.getElementById('progressFill');

        if (!file) {
            alert("Ø£Ø±Ø¬ÙˆÙƒ Ø§Ø®ØªØ± ÙÙŠØ¯ÙŠÙˆ Ø£ÙˆÙ„Ø§Ù‹!");
            return;
        }

        btn.disabled = true;
        progressArea.style.display = 'block';
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...";

        // ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ù„Ù€ Cloudinary
        const formData = new FormData();
        formData.append('file', file);
        formData.append('upload_preset', UPLOAD_PRESET);

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… XMLHttpRequest Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø¯Ù‚Ø©
        const xhr = new XMLHttpRequest();
        xhr.open('POST', `https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, true);

        xhr.upload.onprogress = (e) => {
            if (e.lengthComputable) {
                const percent = (e.loaded / e.total) * 100;
                progressFill.style.width = percent + '%';
                status.innerText = `ØªÙ… Ø±ÙØ¹: ${Math.round(percent)}%`;
            }
        };

        xhr.onload = function() {
            const data = JSON.parse(xhr.responseText);
            if (data.secure_url) {
                // Ø®Ø·ÙˆØ© Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Firebase
                const videoRef = ref(db, 'my_videos');
                const newVideoEntry = push(videoRef);
                
                set(newVideoEntry, {
                    name: file.name,
                    url: data.secure_url,
                    type: "video",
                    date: new Date().toISOString()
                }).then(() => {
                    status.innerText = "ØªÙ… Ø§Ù„Ø±ÙØ¹ ÙˆØ§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ…";
                    btn.disabled = false;
                    fileInput.value = "";
                });
            } else {
                status.innerText = "ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª.";
                btn.disabled = false;
            }
        };

        xhr.onerror = () => {
            status.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„.";
            btn.disabled = false;
        };

        xhr.send(formData);
    };
</script>

</body>
</html>
