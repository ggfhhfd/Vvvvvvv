<script>
    // دالة النطق المحسنة
    function speakText() {
        const inputText = document.getElementById('inputText').value;
        if (!inputText) return alert("اكتب شي يا خوي!");

        // إلغاء أي عمليات نطق معلقة
        window.speechSynthesis.cancel();

        const msg = new SpeechSynthesisUtterance(inputText);
        
        // جلب الأصوات والتأكد منها
        let voices = window.speechSynthesis.getVoices();
        const voiceSelect = document.getElementById('voiceSelect');
        
        if (voices.length > 0) {
            msg.voice = voices[voiceSelect.value];
        }

        msg.lang = 'ar-SA';
        msg.rate = 0.9;
        msg.pitch = 1.0;

        // تنبيه في حال وجود خطأ
        msg.onerror = (event) => {
            console.error('خطأ في النطق:', event.error);
            alert("حدث خطأ في محرك الصوت، جرب تحديث الصفحة.");
        };

        window.speechSynthesis.speak(msg);
    }

    // تأكيد تحميل الأصوات عند فتح الصفحة
    window.onload = () => {
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = loadVoices;
        }
    };
</script>
