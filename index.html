<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClashData - Ø±ÙØ¹ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø§Ø¨Ø·</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .upload-container { background: #1e1e1e; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 100%; max-width: 450px; text-align: center; }
        h2 { color: #ff4757; }
        input { background: #2d2d2d; border: 1px solid #444; padding: 12px; border-radius: 10px; width: 100%; box-sizing: border-box; color: white; margin-bottom: 10px; }
        .tab-btn { background: #333; border: none; color: white; padding: 10px; cursor: pointer; border-radius: 5px; margin-bottom: 15px; }
        .active { background: #ff4757; }
        button#actionBtn { background: linear-gradient(45deg, #ff4757, #ff6b81); color: white; border: none; padding: 15px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        .video-item { background: #262626; padding: 15px; border-radius: 15px; margin-top: 20px; width: 100%; max-width: 450px; border: 1px solid #333; }
        video { width: 100%; border-radius: 10px; margin-top: 10px; }
        .actions { display: flex; justify-content: space-between; align-items: center; }
        .download-link { background: #2ed573; color: white; text-decoration: none; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
    </style>
</head>
<body>

    <div class="upload-container">
        <h2>ğŸš€ ClashData</h2>
        
        <div style="margin-bottom: 15px;">
            <button class="tab-btn active" id="fileTab" onclick="toggleMode('file')">Ù…Ù„Ù Ù…Ù† Ø§Ù„Ø¬Ù‡Ø§Ø²</button>
            <button class="tab-btn" id="urlTab" onclick="toggleMode('url')">Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±</button>
        </div>

        <div id="fileInputArea">
            <input type="file" id="videoFile" accept="video/*">
        </div>

        <div id="urlInputArea" style="display: none;">
            <input type="text" id="videoUrlInput" placeholder="Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù‡Ù†Ø§...">
        </div>
        
        <p id="status" style="font-size: 12px; color: #eccc68;"></p>
        <button id="actionBtn" onclick="processUpload()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</button>
    </div>

    <div id="videoList" style="width: 100%; display: flex; flex-direction: column; align-items: center;"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAm1OfTW_qS4lhSGlqgDd6fiLDj3u93wqI",
        authDomain: "clashdata-8424c.firebaseapp.com",
        databaseURL: "https://clashdata-8424c-default-rtdb.firebaseio.com",
        projectId: "clashdata-8424c",
        storageBucket: "clashdata-8424c.firebasestorage.app",
        appId: "1:1063000922754:web:87087f81c28c2659cb329b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const CLOUD_NAME = "dkpddgzqj";
    const UPLOAD_PRESET = "b2aumssr";

    let mode = 'file';

    window.toggleMode = function(newMode) {
        mode = newMode;
        document.getElementById('fileInputArea').style.display = mode === 'file' ? 'block' : 'none';
        document.getElementById('urlInputArea').style.display = mode === 'url' ? 'block' : 'none';
        document.getElementById('fileTab').className = mode === 'file' ? 'tab-btn active' : 'tab-btn';
        document.getElementById('urlTab').className = mode === 'url' ? 'tab-btn active' : 'tab-btn';
    };

    window.processUpload = async function() {
        const btn = document.getElementById('actionBtn');
        const status = document.getElementById('status');
        let source;

        if (mode === 'file') {
            source = document.getElementById('videoFile').files[0];
            if (!source) return alert("Ø§Ø®ØªØ± Ù…Ù„Ù!");
        } else {
            source = document.getElementById('videoUrlInput').value;
            if (!source) return alert("Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø·Ø§Ù‹!");
        }

        btn.disabled = true;
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ù‚Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©... Ø¯Ù‚ÙŠÙ‚Ø©";

        const formData = new FormData();
        formData.append('file', source); // Cloudinary ÙŠÙ‚Ø¨Ù„ Ø±Ø§Ø¨Ø·Ø§Ù‹ Ø£Ùˆ Ù…Ù„ÙØ§Ù‹ ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø®Ø§Ù†Ø©
        formData.append('upload_preset', UPLOAD_PRESET);

        try {
            const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUD_NAME}/video/upload`, {
                method: 'POST',
                body: formData
            });
            const data = await response.json();

            if (data.secure_url) {
                const videoRef = ref(db, 'my_videos');
                push(videoRef, {
                    name: mode === 'file' ? source.name : "ÙÙŠØ¯ÙŠÙˆ Ù…Ù† Ø±Ø§Ø¨Ø·",
                    url: data.secure_url,
                    date: new Date().toISOString()
                }).then(() => {
                    status.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ…";
                    btn.disabled = false;
                    document.getElementById('videoUrlInput').value = "";
                });
            } else {
                alert("ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø± ÙˆÙŠÙ†ØªÙ‡ÙŠ Ø¨ØµÙŠØºØ© ÙÙŠØ¯ÙŠÙˆ Ù…Ø«Ù„ mp4");
                btn.disabled = false;
            }
        } catch (err) {
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©");
            btn.disabled = false;
        }
    };

    // ÙƒÙˆØ¯ Ø§Ù„Ø¹Ø±Ø¶ (Ù†ÙØ³Ù‡ Ø§Ù„Ø³Ø§Ø¨Ù‚)
    onValue(ref(db, 'my_videos'), (snapshot) => {
        const videoListDiv = document.getElementById('videoList');
        videoListDiv.innerHTML = "";
        const data = snapshot.val();
        if (data) {
            Object.keys(data).reverse().forEach(key => {
                const video = data[key];
                const downloadUrl = video.url.replace('/upload/', '/upload/fl_attachment/');
                const item = document.createElement('div');
                item.className = 'video-item';
                item.innerHTML = `
                    <div class="actions">
                        <span style="font-size:13px;">${video.name}</span>
                        <a href="${downloadUrl}" class="download-link">ØªØ­Ù…ÙŠÙ„ ğŸ“¥</a>
                    </div>
                    <video controls src="${video.url}"></video>
                `;
                videoListDiv.appendChild(item);
            });
        }
    });
</script>
</body>
</html>
