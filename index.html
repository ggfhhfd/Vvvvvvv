<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ - ClashData</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 40px; background: #1a1a1a; color: white; }
        .card { background: #2d2d2d; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 100%; max-width: 450px; text-align: center; }
        input[type="file"] { margin: 20px 0; background: #3d3d3d; padding: 10px; border-radius: 8px; width: 90%; }
        button { background: #ff4757; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; font-weight: bold; font-size: 16px; transition: 0.3s; }
        button:hover { background: #ff6b81; }
        button:disabled { background: #555; cursor: not-allowed; }
        #progContainer { width: 100%; background: #444; border-radius: 20px; margin: 20px 0; display: none; overflow: hidden; }
        #progBar { width: 0%; height: 12px; background: #2ed573; transition: width 0.2s; }
        #status { margin-top: 15px; font-size: 14px; color: #ffa502; }
    </style>
</head>
<body>

<div class="card">
    <h2>Ø±ÙØ¹ ÙÙŠØ¯ÙŠÙˆ Ø¥Ù„Ù‰ ClashData ğŸš€</h2>
    <input type="file" id="videoFile" accept="video/*">
    
    <div id="progContainer">
        <div id="progBar"></div>
    </div>

    <button id="btn" onclick="startUpload()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†</button>
    <p id="status">Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù...</p>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getStorage, ref as sRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";
    import { getDatabase, ref as dRef, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„ØªÙŠ Ø£Ø±ÙÙ‚ØªÙ‡Ø§
    const firebaseConfig = {
        apiKey: "AIzaSyAm1OfTW_qS4lhSGlqgDd6fiLDj3u93wqI",
        authDomain: "clashdata-8424c.firebaseapp.com",
        databaseURL: "https://clashdata-8424c-default-rtdb.firebaseio.com",
        projectId: "clashdata-8424c",
        storageBucket: "clashdata-8424c.firebasestorage.app",
        messagingSenderId: "1063000922754",
        appId: "1:1063000922754:web:87087f81c28c2659cb329b",
        measurementId: "G-FEYNVDC4CD"
    };

    const app = initializeApp(firebaseConfig);
    const storage = getStorage(app);
    const database = getDatabase(app);

    window.startUpload = function() {
        const file = document.getElementById('videoFile').files[0];
        const btn = document.getElementById('btn');
        const status = document.getElementById('status');
        const pBar = document.getElementById('progBar');
        const pContainer = document.getElementById('progContainer');

        if (!file) {
            alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ÙÙŠØ¯ÙŠÙˆ!");
            return;
        }

        btn.disabled = true;
        pContainer.style.display = 'block';
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

        const storagePath = `videos/${Date.now()}_${file.name}`;
        const storageReference = sRef(storage, storagePath);
        const uploadTask = uploadBytesResumable(storageReference, file);

        uploadTask.on('state_changed', 
            (snapshot) => {
                const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                pBar.style.width = progress + '%';
                status.innerText = `ØªÙ… Ø±ÙØ¹ ${Math.round(progress)}%`;
            }, 
            (error) => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Rules ÙÙŠ Firebase");
                console.error(error);
                btn.disabled = false;
            }, 
            () => {
                getDownloadURL(uploadTask.snapshot.ref).then((url) => {
                    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Realtime Database
                    const dbRef = dRef(database, 'uploaded_videos');
                    const newVideo = push(dbRef);
                    set(newVideo, {
                        fileName: file.name,
                        videoUrl: url,
                        time: new Date().toLocaleString()
                    }).then(() => {
                        status.innerText = "ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­ ÙˆØ­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª! âœ…";
                        btn.disabled = false;
                    });
                });
            }
        );
    }
</script>

</body>
</html>
