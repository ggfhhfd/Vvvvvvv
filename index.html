<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø´ØºÙ„ Ø³Ø¨ÙŠØ³ØªÙˆÙ† Ø£ÙˆÙÙ„Ø§ÙŠÙ†</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        #videoPlayer { width: 100%; border-radius: 10px; display: none; margin-top: 20px; background: black; }
        .btn { background-color: #28a745; color: white; border: none; padding: 15px 25px; font-size: 18px; border-radius: 8px; cursor: pointer; width: 100%; margin-top: 20px; }
        .btn:disabled { background-color: #ccc; }
        #status { margin-top: 15px; font-size: 14px; color: #666; }
        .progress-bar { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-top: 10px; display: none; overflow: hidden; }
        #progressFill { width: 0%; height: 100%; background: #007bff; transition: width 0.1s; }
        .delete-btn { background: #dc3545; margin-top: 10px; font-size: 12px; padding: 5px; color: white; border: none; border-radius: 4px; display: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <h2>Ø°ÙƒØ±ÙŠØ§Øª Ø³Ø¨ÙŠØ³ØªÙˆÙ† ğŸ“º</h2>
    <p>Ø§Ø¶ØºØ· ØªØ­Ù…ÙŠÙ„ Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© "Ø§Ø¶Ø­Ùƒ Ù…Ø¹ ÙƒÙˆÙ†Ø§Ù†" ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª.</p>
    
    <button id="downloadBtn" class="btn">ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø¢Ù†</button>
    
    <div class="progress-bar" id="progressBar"><div id="progressFill"></div></div>
    <p id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„...</p>

    <video id="videoPlayer" controls playsinline></video>
    <br>
    <button id="deleteBtn" class="delete-btn">Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø³Ø¬Ù„</button>
</div>

<script>
    // Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡
    const VIDEO_URL = "https://abra--5e4bd524.api.cosmic-crab.buzz/93743992fdffe15b7e075a2e81c5b05c5072c1bc/%D8%A7%D8%B1%D8%B4%D9%8A%D9%81%20%D9%82%D9%86%D8%A7%D8%A9%20%D8%B3%D8%A8%D9%8A%D8%B3%D8%AA%D9%88%D9%86%20%D9%85%D9%86%20%D8%B3%D9%86%D8%A9%202000%20%D8%A7%D9%84%D9%8Ù‰%202001/adhk-konan-sbys-ton.mp4?api-key=8acbcf1e-732c-4574-a3bf-27e6a85b86f1&download=true";

    const downloadBtn = document.getElementById('downloadBtn');
    const videoPlayer = document.getElementById('videoPlayer');
    const status = document.getElementById('status');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const deleteBtn = document.getElementById('deleteBtn');

    let db;
    const request = indexedDB.open("SpacetoonDB", 1);
    request.onupgradeneeded = e => e.target.result.createObjectStore("videos");
    request.onsuccess = e => {
        db = e.target.result;
        checkVideo();
    };

    function checkVideo() {
        const tx = db.transaction("videos", "readonly");
        const req = tx.objectStore("videos").get("savedVideo");
        req.onsuccess = () => {
            if (req.result) {
                renderVideo(req.result);
                status.innerText = "Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù…Ø­ÙÙˆØ¸ ÙˆØ¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ø£ÙˆÙÙ„Ø§ÙŠÙ†!";
                downloadBtn.style.display = 'none';
                deleteBtn.style.display = 'inline-block';
            }
        };
    }

    downloadBtn.onclick = async () => {
        downloadBtn.disabled = true;
        status.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±...";
        progressBar.style.display = 'block';

        try {
            const response = await fetch(VIDEO_URL);
            const reader = response.body.getReader();
            const contentLength = +response.headers.get('Content-Length');
            let receivedLength = 0;
            let chunks = [];

            while(true) {
                const {done, value} = await reader.read();
                if (done) break;
                chunks.push(value);
                receivedLength += value.length;
                if (contentLength) {
                    progressFill.style.width = Math.round((receivedLength / contentLength) * 100) + '%';
                }
            }

            const blob = new Blob(chunks, { type: 'video/mp4' });
            const tx = db.transaction("videos", "readwrite");
            tx.objectStore("videos").put(blob, "savedVideo");
            
            tx.oncomplete = () => {
                renderVideo(blob);
                status.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¥Ø·ÙØ§Ø¡ Ø§Ù„Ù†Øª ÙˆÙ…Ø´Ø§Ù‡Ø¯ØªÙ‡.";
                downloadBtn.style.display = 'none';
                deleteBtn.style.display = 'inline-block';
            };
        } catch (err) {
            status.innerText = "Ø®Ø·Ø£: ØªØ£ÙƒØ¯ Ù…Ù† Ø§ØªØµØ§Ù„Ùƒ Ø¨Ø§Ù„Ù†Øª Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„.";
            downloadBtn.disabled = false;
        }
    };

    function renderVideo(blob) {
        videoPlayer.src = URL.createObjectURL(blob);
        videoPlayer.style.display = 'block';
        progressBar.style.display = 'none';
    }

    deleteBtn.onclick = () => {
        db.transaction("videos", "readwrite").objectStore("videos").delete("savedVideo");
        location.reload();
    };
</script>
</body>
</html>
