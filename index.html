<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø­Ù…Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù†ÙØ§Ø« - Ø§Ø³ØªØ¦Ù†Ø§Ù Ø°ÙƒÙŠ</title>
    <style>
        body { font-family: -apple-system, system-ui; background: #f0f0f7; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 400px; text-align: center; }
        input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        button { width: 48%; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        #startBtn { background: #007aff; color: white; width: 100%; }
        #pauseBtn { background: #ff3b30; color: white; display: none; }
        #resumeBtn { background: #34c759; color: white; display: none; }
        .progress-bar { width: 100%; background: #eee; height: 10px; border-radius: 5px; margin-top: 20px; display: none; overflow: hidden; }
        #fill { width: 0%; height: 100%; background: #007aff; }
        #status { font-size: 12px; color: #666; margin-top: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h3>ğŸš€ Ù…Ø­Ù…Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø°ÙƒÙŠ</h3>
    <input type="text" id="videoUrl" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ù‡Ù†Ø§...">
    <div style="display: flex; gap: 4%;">
        <button id="startBtn" onclick="startDownload()">Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù…ÙŠÙ„</button>
        <button id="pauseBtn" onclick="pauseDownload()">Ø¥ÙŠÙ‚Ø§Ù Ù…Ø¤Ù‚Øª</button>
        <button id="resumeBtn" onclick="startDownload()">Ø§Ø³ØªØ¦Ù†Ø§Ù</button>
    </div>
    <div class="progress-bar" id="pBar"><div id="fill"></div></div>
    <div id="status">Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„</div>
</div>

<script>
    let totalSize = 0;
    let downloadedBytes = 0;
    let chunks = []; // Ù…ØµÙÙˆÙØ© Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ø§ÙƒØªÙ…Ù„Øª
    let isPaused = false;
    let controller;

    async function startDownload() {
        const url = document.getElementById('videoUrl').value;
        if (!url) return alert("ÙŠØ±Ø¬Ù‰ ÙˆØ¶Ø¹ Ø§Ù„Ø±Ø§Ø¨Ø·");

        isPaused = false;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('resumeBtn').style.display = 'none';
        document.getElementById('pauseBtn').style.display = 'inline-block';
        document.getElementById('pBar').style.display = 'block';

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ­Ø¯Ø© ØªØ­ÙƒÙ… Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        controller = new AbortController();

        try {
            // 1. ÙØ­Øµ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
            if (totalSize === 0) {
                const headRes = await fetch(url, { method: 'HEAD' });
                totalSize = parseInt(headRes.headers.get('content-length'));
            }

            // 2. Ø·Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø¢Ø®Ø± Ù†Ù‚Ø·Ø© ØªÙˆÙ‚ÙÙ†Ø§ Ø¹Ù†Ø¯Ù‡Ø§ (Range Header)
            const response = await fetch(url, {
                headers: { 'Range': `bytes=${downloadedBytes}-` },
                signal: controller.signal
            });

            const reader = response.body.getReader();
            
            while (true) {
                const { done, value } = await reader.read();
                
                if (done) {
                    finishDownload();
                    break;
                }

                chunks.push(value);
                downloadedBytes += value.length;

                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                let percent = ((downloadedBytes / totalSize) * 100).toFixed(1);
                document.getElementById('fill').style.width = percent + "%";
                document.getElementById('status').innerText = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${percent}% (${(downloadedBytes / 1024 / 1024).toFixed(2)} MB)`;

                if (isPaused) break;
            }
        } catch (err) {
            if (err.name === 'AbortError') {
                console.log("ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù Ø¨ÙˆØ§Ø³Ø·Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…");
            } else {
                document.getElementById('status').innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±";
            }
        }
    }

    function pauseDownload() {
        isPaused = true;
        controller.abort(); // Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ ÙÙˆØ±Ø§Ù‹
        document.getElementById('pauseBtn').style.display = 'none';
        document.getElementById('resumeBtn').style.display = 'inline-block';
        document.getElementById('status').innerText = "ØªÙ… Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù.. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©";
    }

    function finishDownload() {
        const blob = new Blob(chunks, { type: 'video/mp4' });
        const downloadUrl = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = downloadUrl;
        a.download = "video_" + new Date().getTime() + ".mp4";
        a.click();
        
        document.getElementById('status').innerText = "Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!";
        document.getElementById('pauseBtn').style.display = 'none';
        document.getElementById('startBtn').style.display = 'inline-block';
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØµÙÙŠØ± Ù„Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù…
        totalSize = 0;
        downloadedBytes = 0;
        chunks = [];
    }
</script>
</body>
</html>
